<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Intro to MapView - Create a 2D map - 4.10</title>
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/css/main.css">
  <script src="https://js.arcgis.com/4.17/"></script>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/geometry/Extent",
      "esri/layers/GraphicsLayer",
      "esri/layers/MapImageLayer",
      "esri/layers/support/TileInfo",
      "esri/layers/WebTileLayer",
      "esri/Graphic",
      "esri/Basemap"
    ], function (Map, MapView,Extent, GraphicsLayer,MapImageLayer,TileInfo,WebTileLayer, Graphic,Basemap) {
        
      var tileInfo = new TileInfo({
            dpi: 90.71428571427429,
            size: 256,
            origin: {
                x: -180,
                y: 90
            },
            spatialReference: {
                wkid: 4326
            },
            lods: [
                { level: 2, levelValue: 2, resolution: 0.3515625, scale: 147748796.52937502 },
                { level: 3, levelValue: 3, resolution: 0.17578125, scale: 73874398.264687508 },
                { level: 4, levelValue: 4, resolution: 0.087890625, scale: 36937199.132343754 },
                { level: 5, levelValue: 5, resolution: 0.0439453125, scale: 18468599.566171877 },
                { level: 6, levelValue: 6, resolution: 0.02197265625, scale: 9234299.7830859385 },
                { level: 7, levelValue: 7, resolution: 0.010986328125, scale: 4617149.8915429693 },
                { level: 8, levelValue: 8, resolution: 0.0054931640625, scale: 2308574.9457714846 },
                { level: 9, levelValue: 9, resolution: 0.00274658203125, scale: 1154287.4728857423 },
                { level: 10, levelValue: 10, resolution: 0.001373291015625, scale: 577143.73644287116 },
                { level: 11, levelValue: 11, resolution: 0.0006866455078125, scale: 288571.86822143558 },
                { level: 12, levelValue: 12, resolution: 0.00034332275390625, scale: 144285.93411071779 },
                { level: 13, levelValue: 13, resolution: 0.000171661376953125, scale: 72142.967055358895 },
                { level: 14, levelValue: 14, resolution: 8.58306884765625e-005, scale: 36071.483527679447 },
                { level: 15, levelValue: 15, resolution: 4.291534423828125e-005, scale: 18035.741763839724 },
                { level: 16, levelValue: 16, resolution: 2.1457672119140625e-005, scale: 9017.8708819198619 },
                { level: 17, levelValue: 17, resolution: 1.0728836059570313e-005, scale: 4508.9354409599309 },
                { level: 18, levelValue: 18, resolution: 5.3644180297851563e-006, scale: 2254.4677204799655 },
                { level: 19, levelValue: 19, resolution: 2.68220901489257815e-006, scale: 1127.23386023998275 },
                { level: 20, levelValue: 2, resolution: 1.341104507446289075e-006, scale: 563.616930119991375 }
            ]
        })
     //测试增加地图中台图层
       var gzdtztlayer = new WebTileLayer({
            urlTemplate:
              "http://59.215.221.30:9800/ext/tiandituyingxiang-proxy/img_c/wmts?ua_token=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJIdWFuQmFvVGluZyIsImNyZWF0ZWQiOjE2NDU3NTMwNDIyMDEsImV4cCI6MTc1NjU2OTYwMH0.3tEoYA3ejdqXIV55wlGZsTYD9J77kZ2fG5ny4PHik-DkF_u2-GzhgSVpggP6MaRBWn36HD7eM75ZTPVzbVT7mA&service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={level}&TileRow={row}&TileCol={col}&style=default&format=tiles&tk=5853c0e92459c816623625d1c54d4593",
             
              tileInfo: tileInfo,
              spatialReference: {
                wkid: 4326
            }
            },
          );
          //标注图
      var gzdtztlayerLable = new WebTileLayer({
            urlTemplate: 
            "http://59.215.221.30:9800/ext/tdtyxzj-proxy/cia_c/wmts?ua_token=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJIdWFuQmFvVGluZyIsImNyZWF0ZWQiOjE2NDU3NTMwNDIyMDEsImV4cCI6MTc1NjU2OTYwMH0.3tEoYA3ejdqXIV55wlGZsTYD9J77kZ2fG5ny4PHik-DkF_u2-GzhgSVpggP6MaRBWn36HD7eM75ZTPVzbVT7mA&service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=c&TileMatrix={level}&TileRow={row}&TileCol={col}&style=default&format=tiles&tk=5853c0e92459c816623625d1c54d4593",
            tileInfo: tileInfo,
              spatialReference: {
                wkid: 4326
            }
          });
       let parrLys = [gzdtztlayer,gzdtztlayerLable];
      //let parrLys = [gzdtztlayer];
      // var map=new Map();
      var basemap = new Basemap({
            baseLayers: parrLys,
        });
      var map = new Map({
            basemap: basemap
          });
    
      var layer = new MapImageLayer({
            //   url: "http://59.215.185.190:6080/arcgis/rest/services/guizhou_4490/MapServer",
              url: "http://59.215.185.190:6080/arcgis/rest/services/guizhou/MapServer",
              id: "testID",
            
              sublayers: [{
                  id: 9,
                  visible: false
                },
                {
                  id: 8,
                  visible: false
                },
                {
                  id: 7,
                  visible: true
                }, {
                  id: 5,
                  visible: false
                }, {
                  id: 3,
                  visible: false
                }, {
                  id: 2,
                  visible: false
                }, {
                  id: 1,
                  visible: true
                }, {
                  id: 0,
                  visible: false
                }
              ]
            });
      layer.opacity = 1;

      var view = new MapView({
        container: "viewDiv",
        map: map,
        zoom: 5,
        center: [106.27, 26.5],
        // spatialReference: {
        //       wkid: 4326,
        //     },
      });
     
    map.add(layer);
 
    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>